## Abstract
这篇文章以一个常见的组件——todolist为例，阐述在SPA(Single Page Appliction)的架构该如何设计，才能将各个组件以及组件内部的各种成分解耦。首先我们会明确需求，确定一个Todolist组件的结构和功能，接着我们会给出架构的方案，从而得出一个通用的SPA的架构方案，最后我们会给出实践的代码。
## Introduction
回想一下，在远古时期，我们是怎么浏览网页的？点击一个超链接，然后等待服务器将html页面传输过来。那是一个以“超链接”为中心的web时代，前端承担的任务很小。Ajax的出现改变了这一切，不刷新整个页面也可以和服务器进行通信，使得在前端处理的业务逻辑得以保存，不至于在页面的刷新中丢失。SPA的出现则是将AJAX使用到极致的结果，它几乎就是一个桌面应用,这就意为着前端需要承担绝大部分的业务逻辑，后端只提供数据的增删改查功能即可。复杂的业务逻辑从后端搬到前端，使得原本羸弱的Javascript语言大大得到发展，大量的框架，如AngularJS,VueJS,ReactJS，不断涌现。这篇文章将不采用上述的框架，设计一个通用的架构来实现在SPA中的一个组件。
## 需求
我们的目标是创建一个Todolist组件，包括一个输入框用来输入任务、一个按钮用来提交任务、一个列表用来展示任务和一个tab用来切换不同状态的任务，并且列表中的每个任务项后面带有一个完成按钮、编辑按钮和删除按钮，当我们点击完成按钮时该任务变为完成状态，当我们点击编辑按钮时会弹出一个编辑内容对话框，当我们点击删除按钮时会弹出一个确认对话框问我们是否确认删除。一图胜千言，我们贴出一个简单的原型图来说明需求。
![todolist组件原型图](http://i1.piimg.com/567571/530a880901a28328.png)
Todolist组件可以说是麻雀虽小，五脏俱全，不仅包含了查删改查四种基本操作，还拥有属性和状态。用过像React之类的框架就会知道，一个组件的属性是不变的，在Todolist中可能得属性有“每页列表显示的任务条数”等，其实展示组件的HTML代码也可以看做属性；而状态是可变的，这Todolist这个组件中“未完成/已完成”就是一个明显的状态。
## 设计
我们的组件应该具备以下的特点：
- 可配置：在初始化组件的时候应该可以设置组件的一些属性
- 可复用：比如一个表格组件，应该可以实例化为不同表头的表格实例
- 独立性：组件间不允许相互调用，对底层模块的调用应该有一个统一的入口
针对上面的特点，我们将整个SPA应用设计为MVC的架构，而每个组件也设计为MVC的架构，这就是所谓的FMVC(Fractal Model-View-Controller)，即分型MVC模式。如下图所示。
![](http://i2.buimg.com/567571/b95ff87996e62d79.jpg)
## SPA架构的最佳实践
![](http://i1.piimg.com/567571/5bd48dda79d9e074.jpg)
